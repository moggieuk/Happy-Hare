happy_hare_version = 3.20
formatted_version = $(shell, echo "$(happy_hare_version)" | sed 's/\([0-9]\+\)\.\([0-9]\)\([0-9]\)/\1.\2.\3/')

mainmenu "Happy Hare $(formatted_version) Configuration"

### Helper functions
# Used to convert a shell command result to a y/n value
to_bool = $(shell, $(1) && echo y || echo n)

# Used to get the serial device paths
serial=$(shell, ls /dev/serial/by-id/* 2>/dev/null | grep 'Klipper_$(2)' | tail -n +$(1) | head -n 1)
serial_exists=$(to_bool, [ -e '$(serial,$(1),$(2))' ])
serial_config=$(shell, basename '$(serial,$(1),$(2))' | awk '{print "PARAM_SERIAL_" toupper($0)}')

### Start of configuration
config PARAM_HAPPY_HARE_VERSION
  string
  default "$(happy_hare_version)"

config F_VERSION
  string
  default "$(formatted_version)"

comment '							'
comment '(\\_/)							'
comment '( *,*)							'
comment '(")_(") Happy Hare version $(formatted_version)	 		'	
comment '							'
#comment 'Setting the MMU/AFC type should be done first and will	'
#comment 'default many options to those recommended by the	'
#comment 'designer. After selectiing the mcu board pins can be	'
#comment 'customized in Advanced Settings				'			
#comment '							'

rsource "types/Kconfig"
rsource "boards/Kconfig"
rsource "Kconfig.serial"

config PARAM_NUM_GATES
  int "Number of gates"
  default 4 

rsource "servos/Kconfig"

menu "Common Options"
  rsource "Kconfig.options"
endmenu

menu "Optional Printer/MMU Addons"
  comment '							'
  comment 'MMU functionality can be extended with popular addon	'
  comment 'macro options. Select which to include here and		'
  comment 'configure pins and features				'
  comment '							'

  rsource "addons/Kconfig.*"
endmenu

menu "Advanced Settings"
  comment '							'
  comment 'Only change these settings if you know what you are	'
  comment 'doing (or have MMU customizations) because doing so	'
  comment 'may alter designer detaults. Can be changed later	'
  comment '							'

  config SHOW_ADVANCED_OPTIONS
    bool "Show advanced options in config menus?"
    default n
    help
      When enabled additional (advanced) options will be shown
      throughout the config menus.

  menu "Leds"
    rsource "Kconfig.leds"
  endmenu

  menu "Endstops"
    rsource "Kconfig.endstops"
  endmenu

  menu "Gate loading & parking"
    rsource "Kconfig.gates"
  endmenu

  menu "Motors"
    rsource "Kconfig.motors"
  endmenu

  menu "Speeds"
    rsource "Kconfig.speeds"
  endmenu

  menu "Pins"
    rsource "Kconfig.pins"
  endmenu

  menu "Physical control parameters"
    rsource "Kconfig.params"
  endmenu

  if SHOW_ADVANCED_OPTIONS
    menu "Paths & Services"
      rsource "Kconfig.paths_services"
    endmenu
  endif
endmenu
